// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
syntax = "proto3";

package azdext;

option go_package = "github.com/azure/azure-dev/cli/azd/pkg/azdext";

import "models.proto";

// EventService defines methods for event subscription, invocation, and status updates.
// Clients can subscribe to events and receive notifications via a bidirectional stream.
service EventService {
  // Bidirectional stream for event subscription, invocation, and status updates.
  rpc EventStream(stream EventMessage) returns (stream EventMessage);
}

// Represents different types of messages sent over the stream
message EventMessage {
  string request_id = 1;
  EventErrorMessage error = 99;

  oneof message_type {
    SubscribeProjectEventRequest subscribe_project_event_request = 2;
    SubscribeProjectEventResponse subscribe_project_event_response = 3;
    InvokeProjectHandlerRequest invoke_project_handler_request = 4;
    InvokeProjectHandlerResponse invoke_project_handler_response = 5;
    SubscribeServiceEventRequest subscribe_service_event_request = 6;
    SubscribeServiceEventResponse subscribe_service_event_response = 7;
    InvokeServiceHandlerRequest invoke_service_handler_request = 8;
    InvokeServiceHandlerResponse invoke_service_handler_response = 9;
  }
}

message EventErrorMessage {
  string message = 1;
  string details = 2;
}

// Client subscribes to project-related events
message SubscribeProjectEventRequest {
  // List of event names to subscribe to.
  repeated string event_names = 1;
}

message SubscribeProjectEventResponse{}

// Client subscribes to service-related events
message SubscribeServiceEventRequest {
  // List of event names to subscribe to.
  repeated string event_names = 1;
  string language = 2;
  string host = 3;
}

message SubscribeServiceEventResponse{}

// Server invokes the project event handler
message InvokeProjectHandlerRequest {
  // Name of the event being invoked.
  string event_name = 1;
  // Current project configuration.
  ProjectConfig project = 2;
}

message InvokeProjectHandlerResponse{}

// Server invokes the service event handler
message InvokeServiceHandlerRequest {
  // Name of the event being invoked.
  string event_name = 1;
  // Current project configuration.
  ProjectConfig project = 2;
  // Specific service configuration.
  ServiceConfig service = 3;
  // Service context with artifacts from all lifecycle phases.
  ServiceContext service_context = 4;
}

message InvokeServiceHandlerResponse{}
