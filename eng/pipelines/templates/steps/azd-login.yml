parameters:
  SubscriptionConfiguration: $(sub-config-azure-cloud-test-resources)
  AzdDirectory: "cli/azd"

steps:
  - pwsh: |
      $subscriptionConfiguration = @'
        ${{ parameters.SubscriptionConfiguration }}
      '@ | ConvertFrom-Json -AsHashtable;

# TODO(ellismg): Remove this before merging, want a run with it on to see how things behave.
      ./azd config set auth.useLegacyAzCliAuth true

#     ./azd login `
#       --client-id "$($subscriptionConfiguration.TestApplicationId)" `
#       --client-secret "$($subscriptionConfiguration.TestApplicationSecret)" `
#       --tenant-id "$($subscriptionConfiguration.TenantId)"
        
    workingDirectory: ${{ parameters.AzdDirectory }}
    condition: and(succeeded(), ne(variables['Skip.LiveTest'], 'true'))
    displayName: Azure Dev Login
