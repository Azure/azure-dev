templateApi: 1.0.0
metadata:
  type: repo
  name: todo-csharp-sql
  description: To Do application with a ReactJS frontend, C# API, and Azure SQL.

repo:
  includeProjectAssets: true

  remotes:
    - name: azure-samples-main
      url: git@github.com:Azure-Samples/todo-csharp-sql.git
      branch: main
    - name: azure-samples-staging
      url: git@github.com:Azure-Samples/todo-csharp-sql.git
      branch: staging

  rewrite:
    rules:
    - from: ../../../../../common/infra/appservice/bicep/modules
      to: ./modules
      patterns:
        - "**/*.bicep"

    - from: ../../../../../../common/infra/bicep/modules
      to: ./modules
      patterns:
        - "**/*.bicep"

    - from: ../../../../../common/infra/modules
      to: ./modules
      patterns:
        - "**/*.bicep"   

    # app service modules
    - from: ../../../../../../common/infra/bicep
      to: ../
      patterns:
        - "**/*.bicep"
      ignore:
        - "**/main.bicep"

    # main.bicep
    - from: ../../../../../../common/infra/bicep
      to: ./
      patterns:
        - "**/main.bicep"

    - from: ../../../../common/infra/bicep
      to: ../
      patterns:
        - "**/*.bicep"

    - from: ../../api/csharp-sql
      to: ./src/api
      patterns:
        - "**/azure.@(yml|yaml)"

    - from: ../../web/react-fluent
      to: ./src/web
      patterns:
        - "**/azure.@(yml|yaml)"

  assets:
    # # Common assets

    # Infra 
    - from: ./infra/
      to: ./infra

    - from: ../../../../../common/infra/bicep
      to: ./infra
      patterns:
        - abbreviations.json
        - applicationinsights.bicep
        - applicationinsights-dashboard.bicep
        - appservice.bicep
        - appservice-config-logs.bicep
        - appservice-config-union.bicep
        - appservice-config-sqlserver.bicep
        - appservice-dotnet.bicep
        - appservice-node.bicep
        - appserviceplan.bicep
        - appserviceplan-sites.bicep
        - sqlserver.bicep
        - keyvault.bicep
        - keyvault-access.bicep
        - loganalytics.bicep
    
    - from: ../../../../common/infra/modules
      to: ./infra/modules
      patterns:
        - api-dotnet.bicep
        - web-node.bicep

    - from: ./../../
      to: ./
      ignore: 
        - ".repo/**/*"
        - "repo.y[a]ml"
        - "azure.y[a]ml"

    # openapi.yaml to root
    - from: ../../../../api/common
      to: ./
      patterns:
        - openapi.yaml

    # openapi.yaml to api root
    - from: ../../../../api/common
      to: ./src/api/wwwroot/
      patterns:
        - openapi.yaml

    # Templates common
    - from: ../../../../../common
      to: ./
      ignore:
      - .devcontainer/**/*
      - "infra/**/*"
    
    # .devcontainer common (devcontainer.json)
    - from: ../../../../../common/.devcontainer/devcontainer.json/csharp
      to: ./.devcontainer

    # .devcontainer common (Dockerfile)
    - from: ../../../../../common/.devcontainer/Dockerfile/base
      to: ./.devcontainer

    # Assets common
    - from: ../../../../common/assets
      to: ./assets

    # Tests common
    - from: ../../../../common/tests
      to: ./tests

    # C# API
    - from: ../../../../api/csharp-sql
      to: ./src/api
      ignore:
        - bin
        - obj
        - .vs

    # React Frontend
    - from: ../../../../web/react-fluent
      to: ./src/web
      ignore:
        - "build/**/*"
        - "node_modules/**/*"

    # Azure.yml
    - from: ./azure.yaml
      to: ./azure.yaml