templateApi: 1.0.0
metadata:
  type: repo
  name: todo-python-mongo-aca
  description: ToDo Application with a Python API and Azure Cosmos DB API for MongoDB on Azure Container Apps

repo:
  includeProjectAssets: true

  remotes:
    - name: azure-samples-main
      url: git@github.com:Azure-Samples/todo-python-mongo-aca.git
    - name: azure-samples-staging
      url: git@github.com:Azure-Samples/todo-python-mongo-aca.git
      branch: staging

  rewrite:
    rules:
      - from: ../../../../../common/infra/bicep
        to: ./
        patterns:
          - "**/*.bicep"

      - from: ../../api/python
        to: ./src/api
        patterns: 
            - "**/azure.@(yml|yaml)"

      - from: ../../web/react-fluent
        to: ./src/web
        patterns: 
            - "**/azure.@(yml|yaml)"

  assets:
    # Common assets

    # openapi.yaml to root
    - from: ../../api/common
      to: ./
      patterns:
        - openapi.yaml

    # openapi.yaml to api root
    - from: ../../api/common
      to: ./src/api
      patterns:
        - openapi.yaml

    # Templates common
    - from: ../../../common
      to: ./
      ignore:
        - .github/**/*
        - .devcontainer/**/*
        - "infra/**/*"

    # Github workflows for bicep
    - from: ../../../common/.github/workflows/bicep
      to: ./.github/workflows

    - from: ../../../common/infra/bicep
      to: ./infra

    # .devcontainer common (devcontainer.json)
    - from: ../../../common/.devcontainer/devcontainer.json/python
      to: ./.devcontainer

    # .devcontainer common (Dockerfile)
    - from: ../../../common/.devcontainer/Dockerfile/base
      to: ./.devcontainer

    # Assets common
    - from: ../../common/assets
      to: ./assets

    # Tests common
    - from: ../../common/tests
      to: ./tests

    # ACA infra common
    - from: ../../common/infra/aca/bicep
      to: ./infra

    # Python API
    - from: ../../api/python
      to: ./src/api
      ignore:
        - "**/__pycache__/**"
        - "**/@(venv|.venv)/**"

    # React Frontend
    - from: ../../web/react-fluent
      to: ./src/web
      ignore:
        - "build/**/*"
        - "node_modules/**/*"
